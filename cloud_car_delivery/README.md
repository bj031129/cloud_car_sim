# Cloud Car Delivery

这是一个基于 ROS 2 的自动配送机器人系统。

## 系统架构

### delivery_node.py 运行流程

`delivery_node.py` 是一个自动配送导航节点，负责控制机器人从起点到配送目的地的导航过程。以下是其主要运行流程：

#### 1. 初始化阶段
- 从 `__init__.py` 中读取配置文件路径（`BASE_GOALS_CSV_PATH`）
- 创建 ROS 2 节点并初始化以下组件：
  - 初始位姿发布器 (`/initialpose`)
  - 地址订阅器 (`/delivery_address`)
  - **状态发布器 (`/status`)**
  - 目标位姿发布器 (`/goal_pose`)
  - 相机图像订阅器 (`/camera_sensor/image_raw`)
  - 取货完成订阅器 (`/pickup_complete`)
  - 导航动作客户端 (`navigate_to_pose`)

#### 2. 目标点加载
- 订阅 `/delivery_address` 话题，获取配送地址
- 根据配送地址（如 'TM-3-19'）读取对应的 CSV 文件
- CSV 文件中包含导航路径点信息 (x, y, yaw)

#### 3. 导航执行过程
1. **初始化位姿**
   - 设置机器人初始位置 (0, 0, 0)
   - 发布初始位姿到 `/initialpose` 话题

2. **目标点导航**
   - 开始导航后，将状态设置为 'busy'
   - 按顺序发送目标点
   - 实时监控导航反馈：
     - 每 0.4 秒更新一次距离信息
     - 当距离小于 0.3 米时认为到达目标点
   - 到达目标点后自动发送下一个目标点

3. **终点处理**
   - 到达最终目标点后等待取货
   - 收到取货完成信号后自动返回起点

4. **返回起点**
   - 导航回起始位置 (0, 0, 0)
   - 到达起点后将状态设置为 'leisure'

#### 状态管理
- `status`: 记录机器人当前状态
  - 'leisure': 空闲状态
  - 'busy': 配送任务执行中

#### 状态发布器
- 发布机器人当前状态到 `/status` 话题
- 包括当前总里程数、当前状态、当前位置、当前电量

#### 安全机制
- 导航目标被拒绝时自动重试
- 通过距离阈值（MIN_DISTANCE = 0.3米）判断是否到达目标点
- 定期检查反馈以确保导航正常
